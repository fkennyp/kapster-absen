{% extends 'base.html' %}
{% block title %}Detail Transaksi{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Detail Transaksi</h1>
        <div class="page-header-actions">
            <a href="{{ url_for('user_transactions.my_transactions', start_date=request.args.get('start_date'), end_date=request.args.get('end_date'), page=request.args.get('page', 1)) }}" class="btn">Kembali</a>
        </div>
    </div>

    <div class="card">
        <div class="details-grid">
            <div class="detail-grid">
                <div class="detail-left">
                    <label>No. Invoice</label>
                    <div>{{ transaction.invoice_code }}</div>
                </div>
                <div class="detail-right">
                    <label>Tanggal</label>
                    <div>{{ transaction.created_at.strftime('%d/%m/%Y %H:%M') }}</div>
                </div>

                <div class="detail-left">
                    <label>Pelanggan</label>
                    <div>{{ transaction.customer_name }}</div>
                </div>
                <div class="detail-right">
                    <label>No. HP</label>
                    <div>{{ transaction.customer.phone or '-' }}</div>
                </div>

                <div class="detail-left">
                    <label>Kapster</label>
                    <div>{{ transaction.barber_name }}</div>
                </div>
                <div class="detail-right">
                    <label>Pembayaran</label>
                    <div>{{ transaction.payment_type|upper }}</div>
                </div>

                <div class="detail-left">
                    <label>Total</label>
                    <div>Rp {{ "{:,}".format(transaction.total) }}</div>
                </div>
                {% if transaction.payment_type == 'cash' %}
                <div class="detail-right">
                    <label>Uang Diterima</label>
                    <div>Rp {{ "{:,}".format(transaction.cash_given) }}</div>
                </div>

                <div class="detail-left">
                    <label>Kembalian</label>
                    <div>Rp {{ "{:,}".format(transaction.change_amount) }}</div>
                </div>
                {% endif %}
            </div>

            <h3>Detail Layanan</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Layanan</th>
                        <th>Harga</th>
                        <th>Jumlah</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in transaction.items %}
                    <tr>
                        <td>{{ item.service.name }}</td>
                        <td>Rp {{ "{:,}".format(item.price_each) }}</td>
                        <td>{{ item.qty }}</td>
                        <td>Rp {{ "{:,}".format(item.line_total) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="3" class="text-right">Total:</th>
                        <th>Rp {{ "{:,}".format(transaction.total) }}</th>
                    </tr>
                </tfoot>
            </table>

            <div style="text-align: right; margin-top: 20px;">
                <a href="{{ url_for('sales.receipt_pdf', tx_id=transaction.id) }}" target="_blank" class="btn btn-primary">
                    Download Nota PDF
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}