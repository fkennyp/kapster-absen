{% extends 'base.html' %}
{% block title %}Detail Transaksi{% endblock %}
{% block content %}
<div class="container">
    <div class="card" style="max-width:700px;margin:32px auto;">
        <h2 style="text-align:center;margin-bottom:32px;">Detail Transaksi</h2>
        <div class="details-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:18px 32px;">
            <div><strong>No. Invoice</strong><br>{{ transaction.invoice_code }}</div>
            <div><strong>Tanggal</strong><br>{{ transaction.created_at.strftime('%d/%m/%Y %H:%M') }}</div>
            <div><strong>Pelanggan</strong><br>{{ transaction.customer_name }}</div>
            <div><strong>No. HP</strong><br>{{ transaction.customer.phone or '-' }}</div>
            <div><strong>Kapster</strong><br>{{ transaction.barber_name }}</div>
            <div><strong>Pembayaran</strong><br>{{ transaction.payment_type|upper }}</div>
            {% if transaction.payment_type == 'cash' %}
            <div><strong>Uang Diterima</strong><br>Rp {{ '{:,}'.format(transaction.cash_given) }}</div>
            <div><strong>Kembalian</strong><br>Rp {{ '{:,}'.format(transaction.change_amount) }}</div>
            {% endif %}
        </div>

        <h3 style="margin-top:36px;">Detail Layanan</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Layanan</th>
                    <th>Harga</th>
                    <th>Jumlah</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in transaction.items %}
                <tr>
                    <td>{{ item.service.name }}</td>
                    <td>Rp {{ '{:,}'.format(item.price_each) }}</td>
                    <td>{{ item.qty }}</td>
                    <td>Rp {{ '{:,}'.format(item.line_total) }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3" class="text-right">Subtotal:</th>
                    <th>Rp {{ '{:,}'.format((transaction.total or 0) + (transaction.discount or 0)) }}</th>
                </tr>
                <tr>
                    <th colspan="3" class="text-right">Diskon{% if transaction.discount_name %} ({{ transaction.discount_name }}){% endif %}:</th>
                    <th>Rp {{ '{:,}'.format(transaction.discount or 0) }}</th>
                </tr>
                <tr>
                    <th colspan="3" class="text-right">Total Setelah Diskon:</th>
                    <th>Rp {{ '{:,}'.format(transaction.total or 0) }}</th>
                </tr>
            </tfoot>
        </table>

    <div class="transaction-detail-actions">
            <a href="{{ url_for('user_transactions.my_transactions', start_date=request.args.get('start_date'), end_date=request.args.get('end_date'), page=request.args.get('page', 1)) }}" class="btn">Kembali</a>
            <a href="{{ url_for('sales.receipt_pdf', tx_id=transaction.id) }}" target="_blank" class="btn btn-primary">
                Download Nota PDF
            </a>
        </div>
    </div>
</div>
{% endblock %}