{% extends 'base.html' %}

{% block title %}{{ 'Edit Transaksi' if transaction else 'Detail Transaksi' }}{% endblock %}
{% block content %}
{% if edit_mode %}
<form method="post">
    <div class="container">
        <!-- Form fields for editing transaction (your existing form fields here) -->
        <!-- ...existing code for form fields... -->
        <label for="change_amount">Kembalian</label>
        <input type="text" value="Rp {{ '{:,'.format(transaction.change_amount or 0) }}" class="form-control" readonly>
        <!-- ...existing code for form fields... -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            var paymentType = document.getElementById('payment_type');
            var cashRow = document.getElementById('cash-row');
            function toggleCashRow() {
                if (paymentType.value === 'cash') {
                    cashRow.style.display = 'flex';
                } else {
                    cashRow.style.display = 'none';
                }
            }
            paymentType.addEventListener('change', toggleCashRow);
            toggleCashRow();
        });
        </script>
        <h3>Detail Layanan</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Layanan</th>
                    <th>Harga</th>
                    <th>Jumlah</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in transaction.items %}
                <tr>
                    <td>{{ item.service.name }}</td>
                    <td>Rp {{ "{:,".format(item.price_each) }}</td>
                    <td>{{ item.qty }}</td>
                    <td>Rp {{ "{:,".format(item.line_total) }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3" class="text-right">Subtotal:</th>
                    <th>Rp {{ '{:,'.format((transaction.total or 0) + (transaction.discount or 0)) }}</th>
                </tr>
                <tr>
                    <th colspan="3" class="text-right">Diskon:</th>
                    <th>Rp {{ '{:,'.format(transaction.discount or 0) }}</th>
                </tr>
                <tr>
                    <th colspan="3" class="text-right">Total Setelah Diskon:</th>
                    <th>Rp {{ '{:,'.format(transaction.total or 0) }}</th>
                </tr>
            </tfoot>
        </table>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
            <a href="{{ url_for('admin.transactions_list', start_date=request.args.get('start_date'), end_date=request.args.get('end_date'), user_id=request.args.get('user_id'), page=request.args.get('page', 1)) }}" class="btn">Batal</a>
        </div>
    </div>
</form>
{% else %}
<div class="container">
    {% include '_transaction_detail_fragment.html' %}
</div>
{% endif %}
{% endblock %}
            </div>
        </div>