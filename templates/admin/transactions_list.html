{% extends 'base.html' %}
{% block title %}List Transaksi{% endblock %}
{% block content %}
<h1>List Transaksi</h1>

<form method="get" class="filter-form">
  <div>
    <label for="user_id">Pembuat</label>
    <select id="user_id" name="user_id">
      <option value="">Semua</option>
      {% for u in users %}
        <option value="{{ u.id }}" {% if user_id==u.id %}selected{% endif %}>{{ u.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <button type="submit" class="btn">Filter</button>
  </div>
</form>

<table class="table">
  <thead>
    <tr>
      <th>Invoice</th>
      <th>Tanggal</th>
      <th>Pembuat</th>
      <th class="text-right">Total</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for tx in txs %}
    <tr>
      <td>{{ tx.invoice_code or ("INV-" ~ tx.created_at.strftime("%d/%m/%Y") ~ "-" ~ (tx.invoice_seq or "XXX")) }}</td>
      <td>{{ tx.created_at.strftime("%d-%m-%Y %H:%M:%S") }}</td>
      <td>{{ tx.user.name }}</td>
      <td class="text-right">Rp {{ "{:,}".format(tx.total) }}</td>
      <td><a class="btn" href="{{ url_for('sales.receipt_pdf', tx_id=tx.id) }}" target="_blank">Nota</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% if pagination.pages > 1 %}
<div class="flex items-center gap-2">
  {% if pagination.has_prev %}
    <a class="btn" href="{{ url_for('admin.transactions_list', page=pagination.prev_num, user_id=user_id) }}">&laquo; Prev</a>
  {% endif %}
  <span>Page {{ pagination.page }} / {{ pagination.pages }}</span>
  {% if pagination.has_next %}
    <a class="btn" href="{{ url_for('admin.transactions_list', page=pagination.next_num, user_id=user_id) }}">Next &raquo;</a>
  {% endif %}
</div>
{% endif %}
{% endblock %}
