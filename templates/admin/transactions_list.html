{% extends 'base.html' %}
{% block title %}List Transaksi{% endblock %}

{% block head %}
{{ super() }}
<script src="{{ url_for('static', filename='js/transaction-filters.js') }}" defer></script>
{% endblock %}

{% block content %}
<h1>List Transaksi</h1>

<!-- Filter Form -->
<div class="card">
    <h3>Filter Transaksi</h3>
    <form method="get" class="filter-form">
        <div>
            <label for="start_date">Tanggal Mulai</label>
            <input type="date" id="start_date" name="start_date" value="{{ request.args.get('start_date', '') }}">
        </div>
        <div>
            <label for="end_date">Tanggal Akhir</label>
            <input type="date" id="end_date" name="end_date" value="{{ request.args.get('end_date', '') }}">
        </div>
        <div>
            <label for="user_id">Kapster</label>
            <select id="user_id" name="user_id">
                <option value="">Semua Kapster</option>
                {% for u in users %}
                <option value="{{ u.id }}" {% if request.args.get('user_id')|int==u.id %}selected{% endif %}>
                    {{ u.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div>
            <button type="submit" class="btn">Filter</button>
            <a href="{{ url_for('admin.transactions_list') }}" class="btn">Reset</a>

            <a href="{{ url_for('admin.export_transactions_xlsx') }}?{{ request.query_string.decode() }}"
                class="btn btn-success" title="Export ke Excel">
                Export Excel
            </a>
        </div>
    </form>

    <!-- Penjelasan total transaksi sesuai filter -->
    <div style="margin: 18px 0 10px 0;">
        {% if request.args.get('start_date') or request.args.get('end_date') or request.args.get('user_id') %}
        <strong>Total transaksi ditampilkan:</strong> Rp {{ "{:,}".format(total_amount) }}
        {% endif %}
    </div>

    <!-- Transaction List -->
    <div class="card">
        <h3>Data Transaksi</h3>
        <div class="table-responsive" id="transactions-table">
            <!-- Content will be loaded here via AJAX -->
            {% include 'admin/transactions_table.html' %}
        </div>
    </div>
    </div>
</div>
{% endblock %}