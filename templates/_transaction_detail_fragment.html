<div class="card" style="max-width:700px;margin:32px auto;">
    <h2 style="text-align:center;margin-bottom:32px;">Detail Transaksi</h2>
    <div class="details-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:18px 32px;">
        <div><strong>No. Invoice</strong><br>{{ transaction.invoice_code }}</div>
        <div><strong>Tanggal</strong><br>{{ transaction.created_at.strftime('%d/%m/%Y %H:%M') }}</div>
        <div><strong>Pelanggan</strong><br>{{ transaction.customer_name }}</div>
        <div><strong>No. HP</strong><br>{{ transaction.customer.phone or '-' }}</div>
        <div><strong>Kapster</strong><br>{{ transaction.barber_name }}</div>
        <div><strong>Pembayaran</strong><br>{{ transaction.payment_type|upper }}</div>
        {% if transaction.payment_type == 'cash' %}
        <div><strong>Uang Diterima</strong><br>
            Rp {{ "{:,.0f}".format(transaction.cash_given or 0).replace(",", ".") }}
        </div>
        <div><strong>Kembalian</strong><br>
            Rp {{ "{:,.0f}".format(transaction.change_amount or 0).replace(",", ".") }}
        </div>
        {% endif %}
    </div>

    <h3 style="margin-top:36px;">Detail Layanan</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Layanan</th>
                <th>Harga</th>
                <th>Jumlah</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in transaction.items %}
            <tr>
                <td>{{ item.service.name }}</td>
                <td>Rp {{ "{:,.0f}".format(item.price_each).replace(",", ".") }}</td>
                <td>{{ item.qty }}</td>
                <td>Rp {{ "{:,.0f}".format(item.line_total).replace(",", ".") }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-right">Subtotal:</th>
                <th>Rp {{ "{:,.0f}".format((transaction.total or 0) + (transaction.discount or 0)).replace(",", ".") }}</th>
            </tr>
            <tr>
                <th colspan="3" class="text-right">Diskon{% if transaction.discount_name %} ({{ transaction.discount_name }}){% endif %}:</th>
                <th>Rp {{ "{:,.0f}".format(transaction.discount or 0).replace(",", ".") }}</th>
            </tr>
            <tr>
                <th colspan="3" class="text-right">Total Setelah Diskon:</th>
                <th>Rp {{ "{:,.0f}".format(transaction.total or 0).replace(",", ".") }}</th>
            </tr>
        </tfoot>
    </table>

    <div style="text-align: right; margin-top: 20px; display: flex; gap: 8px; justify-content: flex-end; flex-wrap: wrap;">
    {% if is_admin %}
    <a href="{{ request.referrer or url_for('admin.transactions_list') }}" class="btn btn-secondary">Kembali</a>
    {% else %}
    <a href="{{ request.referrer or url_for('user_transactions.my_transactions', start_date=request.args.get('start_date'), end_date=request.args.get('end_date'), page=request.args.get('page', 1)) }}" class="btn btn-secondary">Kembali</a>
    {% endif %}
        <a href="{{ url_for('sales.receipt_pdf', tx_id=transaction.id) }}" target="_blank" class="btn btn-primary">
            Download Nota PDF
        </a>
        {% if is_admin %}
        <a href="{{ url_for('admin.transaction_edit', transaction_id=transaction.id) }}" class="btn btn-warning">Edit Transaksi</a>
        <form action="{{ url_for('admin.transaction_delete', transaction_id=transaction.id) }}" method="post" style="display: inline-block;" onsubmit="return confirm('Anda yakin ingin menghapus transaksi ini? Aksi ini tidak dapat dibatalkan.');">
            <button type="submit" class="btn btn-danger">Hapus Transaksi</button>
        </form>
        {% endif %}
    </div>
</div>
